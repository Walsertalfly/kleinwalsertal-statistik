name: Update Tourism Data

on:
  schedule:
    # LÃ¤uft tÃ¤glich um 6:00 Uhr UTC (7:00 MEZ / 8:00 MESZ)
    - cron: '0 6 * * *'
  workflow_dispatch: # ErmÃ¶glicht manuelles AusfÃ¼hren

jobs:
  update-data:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Create data directory
        run: mkdir -p data
      
      - name: Download main CSV (Ãœbernachtungen & AnkÃ¼nfte)
        run: |
          curl -L -o data/hauptgliederung.csv \
            "https://www.data.gv.at/katalog/dataset/3ef56cc4-3dcc-4f31-9f82-b62bb34bbe99/resource/4f86b84d-8f58-4f35-ae1a-d94bcdfcc8c9/download/wirfin_vbg_tour_ankuenfte_naechtigungen_hauptgliederung_monatlich.csv"
      
      - name: Download countries CSV (HerkunftslÃ¤nder)
        run: |
          curl -L -o data/staaten.csv \
            "https://www.data.gv.at/katalog/dataset/3ef56cc4-3dcc-4f31-9f82-b62bb34bbe99/resource/db9d31c0-e38b-43c0-aa27-00b8bb148ca5/download/wirfin_vbg_tour_ankuenfte_naechtigungen_staaten_monatlich.csv"
      
      - name: Update timestamp
        run: |
          echo "Letztes Update: $(date '+%Y-%m-%d %H:%M:%S UTC')" > data/last-update.txt
      
      - name: Commit and push if changed
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add data/
          git diff --staged --quiet || git commit -m "ðŸ“Š Daten-Update $(date '+%Y-%m-%d')"
          git push
