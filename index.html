<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kleinwalsertal Tourismus Statistik | √úbernachtungen, Herkunft & Trends</title>
    <meta name="description" content="Offizielle Tourismusstatistiken f√ºr Kleinwalsertal - √úbernachtungen, Ank√ºnfte, Herkunftsl√§nder, Unterkunftsarten und Saisonanalyse. Daten vom Land Vorarlberg.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --primary: #1e3a5f; --primary-light: #2d5a87; --accent: #4a9b7f; --accent-light: #6bc4a6;
            --gold: #c9a227; --gold-light: #e8c547; --snow: #f0f4f8; --ice: #e1e8ed;
            --mountain: #8b9eb3; --forest: #2d5a47; --sunset: #d4735e; --bg: #fafbfc;
            --surface: #ffffff; --text: #1a2a3a; --text-sec: #5a6a7a; --text-muted: #8a9aaa;
            --border: #e5eaef; --shadow-sm: 0 1px 2px rgba(30,58,95,0.04);
            --shadow: 0 2px 8px rgba(30,58,95,0.08); --shadow-md: 0 4px 16px rgba(30,58,95,0.1);
            --shadow-lg: 0 8px 32px rgba(30,58,95,0.12); --radius-sm: 8px; --radius: 12px;
            --radius-lg: 20px; --transition: 0.2s ease;
        }
        [data-theme="dark"] {
            --bg: #0d1117; --surface: #161b22; --text: #e6edf3; --text-sec: #8b949e;
            --text-muted: #6e7681; --border: #30363d; --snow: #21262d; --ice: #30363d;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.2); --shadow: 0 2px 8px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.4); --shadow-lg: 0 8px 32px rgba(0,0,0,0.5);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif; line-height: 1.6; color: var(--text); background: var(--bg); min-height: 100vh; }
        .hero { position: relative; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 50%, var(--accent) 100%); color: white; padding: 0; overflow: hidden; }
        .hero::before { content: ''; position: absolute; inset: 0; background: url("data:image/svg+xml,%3Csvg viewBox='0 0 1200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 200 L0 120 Q100 80 200 100 T400 90 T600 110 T800 85 T1000 105 T1200 95 L1200 200 Z' fill='%23ffffff' opacity='0.03'/%3E%3C/svg%3E") bottom/cover no-repeat; pointer-events: none; }
        .hero-content { position: relative; max-width: 1400px; margin: 0 auto; padding: 60px 32px 80px; }
        .hero-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 40px; flex-wrap: wrap; gap: 20px; }
        .hero-brand { display: flex; align-items: center; gap: 16px; }
        .hero-logo { width: 56px; height: 56px; background: rgba(255,255,255,0.15); border-radius: var(--radius); display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .hero-logo svg { width: 32px; height: 32px; fill: white; }
        .hero-title-group h1 { font-family: 'Playfair Display', Georgia, serif; font-size: clamp(2rem, 5vw, 3.5rem); font-weight: 700; letter-spacing: -0.02em; line-height: 1.1; }
        .hero-title-group .region { font-size: 1rem; font-weight: 500; opacity: 0.85; letter-spacing: 0.1em; text-transform: uppercase; margin-top: 4px; }
        .hero-controls { display: flex; gap: 12px; align-items: center; }
        .theme-toggle { width: 44px; height: 44px; border-radius: var(--radius-sm); border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.1); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition); }
        .theme-toggle:hover { background: rgba(255,255,255,0.2); }
        .status-pill { display: inline-flex; align-items: center; gap: 8px; padding: 10px 16px; background: rgba(255,255,255,0.15); border-radius: 100px; font-size: 0.875rem; font-weight: 500; backdrop-filter: blur(10px); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: #4ade80; animation: pulse 2s infinite; }
        .status-dot.offline { background: #ef4444; animation: none; }
        .status-dot.loading { background: #fbbf24; }
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(0.9); } }
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 16px; margin-top: 32px; }
        .kpi-card { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.15); border-radius: var(--radius); padding: 20px; transition: var(--transition); }
        .kpi-card:hover { background: rgba(255,255,255,0.15); transform: translateY(-2px); }
        .kpi-label { font-size: 0.75rem; font-weight: 500; text-transform: uppercase; letter-spacing: 0.08em; opacity: 0.8; margin-bottom: 6px; }
        .kpi-value { font-size: 1.75rem; font-weight: 700; line-height: 1.1; margin-bottom: 4px; }
        .kpi-detail { font-size: 0.8125rem; opacity: 0.75; }
        .kpi-trend { display: inline-flex; align-items: center; gap: 4px; font-size: 0.75rem; font-weight: 600; margin-top: 8px; padding: 3px 8px; border-radius: 100px; }
        .kpi-trend.up { background: rgba(74, 222, 128, 0.2); color: #4ade80; }
        .kpi-trend.down { background: rgba(248, 113, 113, 0.2); color: #f87171; }
        .container { max-width: 1400px; margin: 0 auto; padding: 0 32px; }
        .main-content { padding: 48px 0 80px; }
        .section { margin-bottom: 48px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; margin-bottom: 24px; }
        .section-title { font-family: 'Playfair Display', Georgia, serif; font-size: 1.75rem; font-weight: 600; color: var(--text); }
        .section-subtitle { font-size: 0.9375rem; color: var(--text-sec); margin-top: 4px; }
        .card { background: var(--surface); border-radius: var(--radius-lg); box-shadow: var(--shadow); border: 1px solid var(--border); overflow: hidden; }
        .card-header { padding: 24px 28px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; }
        .card-title { font-size: 1.125rem; font-weight: 600; }
        .card-body { padding: 28px; }
        .controls { display: flex; flex-wrap: wrap; gap: 12px; align-items: center; }
        .control-group { display: flex; align-items: center; gap: 8px; }
        .control-label { font-size: 0.875rem; color: var(--text-sec); font-weight: 500; }
        select { padding: 10px 14px; border: 1px solid var(--border); border-radius: var(--radius-sm); background: var(--surface); color: var(--text); font-size: 0.9375rem; font-family: inherit; transition: var(--transition); cursor: pointer; }
        select:hover { border-color: var(--primary-light); }
        select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(30,58,95,0.1); }
        .btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 18px; border-radius: var(--radius-sm); font-size: 0.9375rem; font-weight: 500; font-family: inherit; cursor: pointer; transition: var(--transition); border: none; }
        .btn-secondary { background: var(--snow); color: var(--text); border: 1px solid var(--border); }
        .btn-secondary:hover { background: var(--ice); }
        .tabs { display: flex; gap: 4px; background: var(--snow); padding: 4px; border-radius: var(--radius-sm); }
        .tab { padding: 8px 16px; border: none; background: transparent; color: var(--text-sec); font-size: 0.875rem; font-weight: 500; font-family: inherit; cursor: pointer; border-radius: 6px; transition: var(--transition); }
        .tab:hover { color: var(--text); }
        .tab.active { background: var(--surface); color: var(--text); box-shadow: var(--shadow-sm); }
        .chart-container { position: relative; height: 400px; width: 100%; }
        .chart-container-sm { height: 300px; }
        @media (max-width: 768px) { .chart-container { height: 300px; } .chart-container-sm { height: 250px; } }
        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; }
        @media (max-width: 900px) { .grid-2 { grid-template-columns: 1fr; } }
        .table-wrapper { overflow-x: auto; margin: -28px; padding: 28px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9375rem; }
        th, td { padding: 14px 16px; text-align: left; border-bottom: 1px solid var(--border); }
        th { font-weight: 600; color: var(--text-sec); font-size: 0.8125rem; text-transform: uppercase; letter-spacing: 0.05em; background: var(--snow); position: sticky; top: 0; }
        tbody tr:hover { background: var(--snow); }
        .table-year { font-weight: 600; color: var(--primary); }
        .table-number { font-variant-numeric: tabular-nums; }
        .table-change { display: inline-flex; align-items: center; gap: 4px; font-weight: 500; font-size: 0.8125rem; }
        .table-change.positive { color: var(--accent); }
        .table-change.negative { color: var(--sunset); }
        .badge { display: inline-flex; align-items: center; padding: 4px 10px; border-radius: 100px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.03em; }
        .badge-actual { background: rgba(45, 90, 71, 0.1); color: var(--forest); }
        .badge-estimated { background: rgba(201, 162, 39, 0.15); color: var(--gold); }
        .heatmap-grid { display: grid; grid-template-columns: 80px repeat(12, 1fr); gap: 4px; }
        .heatmap-header { font-size: 0.75rem; font-weight: 600; color: var(--text-sec); text-align: center; padding: 8px 4px; }
        .heatmap-row-label { font-size: 0.875rem; font-weight: 600; display: flex; align-items: center; }
        .heatmap-cell { aspect-ratio: 1; border-radius: 6px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: var(--transition); position: relative; min-height: 40px; }
        .heatmap-cell:hover { transform: scale(1.08); z-index: 10; }
        .heatmap-cell .tooltip { position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); background: var(--text); color: white; padding: 8px 12px; border-radius: 8px; font-size: 0.8rem; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.2s; z-index: 100; margin-bottom: 4px; }
        .heatmap-cell:hover .tooltip { opacity: 1; }
        .heatmap-legend { display: flex; align-items: center; gap: 8px; margin-top: 20px; justify-content: center; flex-wrap: wrap; }
        .heatmap-legend-color { width: 24px; height: 24px; border-radius: 4px; }
        .country-item { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border); }
        .country-item:last-child { border-bottom: none; }
        .country-flag { font-size: 1.5rem; }
        .country-name { flex: 1; font-weight: 500; }
        .country-value { font-weight: 600; color: var(--primary); }
        .country-pct { font-size: 0.875rem; color: var(--text-sec); margin-left: 8px; }
        .country-bar { height: 6px; background: var(--snow); border-radius: 3px; margin-top: 4px; overflow: hidden; }
        .country-bar-fill { height: 100%; border-radius: 3px; background: linear-gradient(90deg, var(--primary), var(--primary-light)); }
        .accommodation-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
        .accommodation-card { background: var(--snow); border-radius: var(--radius); padding: 20px; text-align: center; }
        .accommodation-icon { font-size: 2rem; margin-bottom: 8px; }
        .accommodation-name { font-weight: 600; margin-bottom: 4px; }
        .accommodation-value { font-size: 1.5rem; font-weight: 700; color: var(--primary); }
        .accommodation-pct { font-size: 0.875rem; color: var(--text-sec); }
        .accommodation-trend { font-size: 0.8125rem; margin-top: 8px; }
        .accommodation-trend.up { color: var(--accent); }
        .accommodation-trend.down { color: var(--sunset); }
        .footer { background: var(--surface); border-top: 1px solid var(--border); padding: 40px 0; }
        .footer-content { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 48px; }
        @media (max-width: 768px) { .footer-content { grid-template-columns: 1fr; gap: 32px; } }
        .footer-brand h3 { font-family: 'Playfair Display', Georgia, serif; font-size: 1.25rem; margin-bottom: 12px; }
        .footer-brand p { color: var(--text-sec); font-size: 0.9375rem; line-height: 1.6; }
        .footer-section h4 { font-size: 0.875rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-sec); margin-bottom: 16px; }
        .footer-links { list-style: none; display: flex; flex-direction: column; gap: 10px; }
        .footer-links a { color: var(--text); text-decoration: none; font-size: 0.9375rem; transition: var(--transition); }
        .footer-links a:hover { color: var(--primary); }
        .footer-bottom { margin-top: 32px; padding-top: 24px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; font-size: 0.875rem; color: var(--text-sec); }
        @media (max-width: 768px) { 
            .hero-content { padding: 40px 20px 60px; } 
            .hero-title-group h1 { font-size: 1.75rem; } 
            .kpi-grid { grid-template-columns: repeat(2, 1fr); gap: 12px; } 
            .kpi-card { padding: 16px; } 
            .kpi-value { font-size: 1.5rem; } 
            .container { padding: 0 16px; } 
            .card-body { padding: 20px; } 
            .section-title { font-size: 1.5rem; }
            .heatmap-grid { grid-template-columns: 50px repeat(12, 1fr); gap: 2px; }
            .heatmap-header { font-size: 0.6rem; padding: 4px 2px; }
            .heatmap-cell { min-height: 30px; border-radius: 4px; }
        }
    </style>
</head>
<body>
    <header class="hero">
        <div class="hero-content">
            <div class="hero-top">
                <div class="hero-brand">
                    <div class="hero-logo"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L2 12h3v8h6v-6h2v6h6v-8h3L12 2zm0 2.8L18.2 11H17v8h-4v-6H11v6H7v-8H5.8L12 4.8z"/></svg></div>
                    <div class="hero-title-group">
                        <h1>Tourismus Statistik</h1>
                        <div class="region">Kleinwalsertal ¬∑ Gemeinde Mittelberg</div>
                    </div>
                </div>
                <div class="hero-controls">
                    <div class="status-pill"><span class="status-dot loading" id="statusDot"></span><span id="statusText">Lade...</span></div>
                    <button class="theme-toggle" onclick="toggleTheme()" title="Theme wechseln"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg></button>
                </div>
            </div>
            <div class="kpi-grid">
                <div class="kpi-card"><div class="kpi-label">Jahr 2025</div><div class="kpi-value" id="kpiNights">‚Äî</div><div class="kpi-detail">√úbernachtungen</div><div class="kpi-trend" id="kpiNightsTrend"></div></div>
                <div class="kpi-card"><div class="kpi-label">Ank√ºnfte 2025</div><div class="kpi-value" id="kpiArrivals">‚Äî</div><div class="kpi-trend" id="kpiArrivalsTrend"></div></div>
                <div class="kpi-card"><div class="kpi-label">√ò Aufenthalt</div><div class="kpi-value" id="kpiStay">‚Äî</div><div class="kpi-detail">N√§chte</div></div>
                <div class="kpi-card"><div class="kpi-label">Top Herkunft</div><div class="kpi-value" id="kpiTopCountry">üá©üá™</div><div class="kpi-detail" id="kpiTopCountryPct">‚Äî</div></div>
                <div class="kpi-card"><div class="kpi-label">J√§nner 2026</div><div class="kpi-value" id="kpi2026">‚Äî</div><div class="kpi-detail">vorl√§ufig</div></div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            
            <!-- 1. ZEITVERLAUF -->
            <section class="section">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìà Kleinwalsertal im Zeitverlauf</h3>
                        <div class="controls">
                            <div class="tabs">
                                <button class="tab active" data-chart="line">Linie</button>
                                <button class="tab" data-chart="bar">Balken</button>
                            </div>
                            <div class="control-group">
                                <label class="control-label">Von:</label>
                                <select id="yearFrom"></select>
                            </div>
                            <div class="control-group">
                                <label class="control-label">Bis:</label>
                                <select id="yearTo"></select>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container"><canvas id="mainChart"></canvas></div>
                    </div>
                </div>
            </section>

            <!-- 2. MONATLICHE VERTEILUNG -->
            <section class="section">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìä Monatliche Verteilung</h3>
                        <div class="controls">
                            <div class="control-group">
                                <label class="control-label">Jahr:</label>
                                <select id="monthlyYear"></select>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container"><canvas id="monthlyChart"></canvas></div>
                    </div>
                </div>
            </section>

            <!-- 3. ALLE JAHRESDATEN -->
            <section class="section">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìã Alle Jahresdaten</h3>
                        <button class="btn btn-secondary" onclick="exportCSV()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                            CSV Export
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-wrapper">
                            <table>
                                <thead><tr><th>Jahr</th><th>√úbernachtungen</th><th>Ank√ºnfte</th><th>√ò Aufenthalt</th><th>Ver√§nderung</th><th>Status</th></tr></thead>
                                <tbody id="tableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 4. HEATMAP (5 Jahre) -->
            <section class="section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">üìÖ Saisonale Buchungsst√§rke</h2>
                        <p class="section-subtitle">√úbernachtungen pro Monat ¬∑ 2022‚Äì2026</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <div id="heatmapContainer"></div>
                        <div class="heatmap-legend">
                            <span style="font-size:0.85rem;color:var(--text-sec);margin-right:8px;">Nebensaison</span>
                            <div class="heatmap-legend-color" style="background:#dbeafe;"></div>
                            <div class="heatmap-legend-color" style="background:#93c5fd;"></div>
                            <div class="heatmap-legend-color" style="background:#3b82f6;"></div>
                            <div class="heatmap-legend-color" style="background:#1d4ed8;"></div>
                            <div class="heatmap-legend-color" style="background:#1e3a5f;"></div>
                            <span style="font-size:0.85rem;color:var(--text-sec);margin-left:8px;">Hochsaison</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 5. HERKUNFTSL√ÑNDER -->
            <section class="section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">üåç Woher kommen die G√§ste?</h2>
                        <p class="section-subtitle">Herkunftsl√§nder der √úbernachtungsg√§ste</p>
                    </div>
                    <div class="controls">
                        <div class="control-group">
                            <label class="control-label">Jahr:</label>
                            <select id="countryYear"></select>
                        </div>
                    </div>
                </div>
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header"><h3 class="card-title">Verteilung nach L√§ndern</h3></div>
                        <div class="card-body">
                            <div class="chart-container chart-container-sm"><canvas id="countryPieChart"></canvas></div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header"><h3 class="card-title">Top Herkunftsl√§nder</h3></div>
                        <div class="card-body">
                            <div id="countryList"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 6. HERKUNFTSTREND (10 Jahre) -->
            <section class="section">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìà Entwicklung der Herkunftsm√§rkte ¬∑ 10 Jahre</h3>
                        <div class="controls">
                            <div class="control-group">
                                <label class="control-label">Von:</label>
                                <select id="countryTrendFrom"></select>
                            </div>
                            <div class="control-group">
                                <label class="control-label">Bis:</label>
                                <select id="countryTrendTo"></select>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container"><canvas id="countryTrendChart"></canvas></div>
                    </div>
                </div>
            </section>

            <!-- 7. UNTERKUNFTSARTEN -->
            <section class="section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">üè® Unterkunftsarten</h2>
                        <p class="section-subtitle">Hotels vs. Ferienwohnungen vs. Privatquartiere</p>
                    </div>
                    <div class="controls">
                        <div class="control-group">
                            <label class="control-label">Jahr:</label>
                            <select id="accommodationYear"></select>
                        </div>
                    </div>
                </div>
                <div id="accommodationCards" class="accommodation-grid"></div>
                <div class="card" style="margin-top: 24px;">
                    <div class="card-header"><h3 class="card-title">Entwicklung nach Unterkunftsart</h3></div>
                    <div class="card-body">
                        <div class="chart-container"><canvas id="accommodationChart"></canvas></div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <h3>Kleinwalsertal Tourismus Statistik</h3>
                    <p>Offizielle Tourismusdaten der Gemeinde Mittelberg, bereitgestellt vom Land Vorarlberg als Open Government Data.</p>
                </div>
                <div class="footer-section">
                    <h4>Datenquellen</h4>
                    <ul class="footer-links">
                        <li><a href="https://www.data.gv.at/katalog/dataset/land-vorarlberg_tourismusstatistik" target="_blank">data.gv.at</a></li>
                        <li><a href="https://vorarlberg.at/-/wirtschaft-tourismus-verkehr" target="_blank">Land Vorarlberg</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Rechtliches</h4>
                    <ul class="footer-links">
                        <li><a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0 Lizenz</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <span>¬© 2026 ¬∑ Daten: Land Vorarlberg (OGD)</span>
                <span>Stand: 4. Februar 2026</span>
            </div>
        </div>
    </footer>

    <script>
        const CONFIG = {
            // Lokale Dateien (von GitHub Actions t√§glich aktualisiert)
            CSV_URL: 'data/hauptgliederung.csv',
            COUNTRIES_CSV_URL: 'data/staaten.csv',
            GKZ: '80228',
            MONTHS_DE: ['J√§n', 'Feb', 'M√§r', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
            MONTHS_FULL: ['J√§nner', 'Februar', 'M√§rz', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'],
            COUNTRY_FLAGS: { 'Deutschland': 'üá©üá™', '√ñsterreich': 'üá¶üáπ', 'Schweiz': 'üá®üá≠', 'Niederlande': 'üá≥üá±', 'Belgien': 'üáßüá™', 'Frankreich': 'üá´üá∑', 'Gro√übritannien': 'üá¨üáß', 'Italien': 'üáÆüáπ', 'Sonstige': 'üåê' },
            COUNTRY_COLORS: ['#1e3a5f', '#c9a227', '#4a9b7f', '#d4735e', '#8b5cf6', '#ec4899', '#06b6d4', '#f59e0b'],
            ACCOMMODATION_TYPES: { 'Hotels': { icon: 'üè®', color: '#1e3a5f' }, 'Ferienwohnungen': { icon: 'üè†', color: '#4a9b7f' }, 'Private': { icon: 'üè°', color: '#c9a227' }, 'Sonstige': { icon: 'üèïÔ∏è', color: '#8b9eb3' } }
        };

        let yearlyData = [], monthlyData = {}, countryData = {}, accommodationData = {};
        let mainChart, monthlyChart, countryPieChart, countryTrendChart, accommodationChart;

        // FALLBACK: 10 Jahre (2016-2025) + 2026 Januar
        const FALLBACK = {
            yearly: [
                { year: 2016, nights: 1350000, arrivals: 286000, status: 'actual' },
                { year: 2017, nights: 1358000, arrivals: 291000, status: 'actual' },
                { year: 2018, nights: 1404000, arrivals: 302000, status: 'actual' },
                { year: 2019, nights: 1410000, arrivals: 310000, status: 'actual' },
                { year: 2020, nights: 850000, arrivals: 195000, status: 'actual' },
                { year: 2021, nights: 920000, arrivals: 210000, status: 'actual' },
                { year: 2022, nights: 1260000, arrivals: 285000, status: 'actual' },
                { year: 2023, nights: 1295000, arrivals: 297000, status: 'actual' },
                { year: 2024, nights: 1340000, arrivals: 312000, status: 'actual' },
                { year: 2025, nights: 1365000, arrivals: 318000, status: 'actual' },
                { year: 2026, nights: 185000, arrivals: 42000, status: 'estimated' }
            ],
            monthly: {
                2022: { 1: 168000, 2: 155000, 3: 138000, 4: 52000, 5: 48000, 6: 78000, 7: 125000, 8: 142000, 9: 98000, 10: 68000, 11: 58000, 12: 130000 },
                2023: { 1: 175000, 2: 162000, 3: 142000, 4: 55000, 5: 50000, 6: 82000, 7: 128000, 8: 145000, 9: 102000, 10: 72000, 11: 62000, 12: 120000 },
                2024: { 1: 182000, 2: 168000, 3: 148000, 4: 58000, 5: 52000, 6: 85000, 7: 132000, 8: 150000, 9: 108000, 10: 78000, 11: 65000, 12: 114000 },
                2025: { 1: 188000, 2: 172000, 3: 152000, 4: 60000, 5: 55000, 6: 88000, 7: 138000, 8: 155000, 9: 112000, 10: 82000, 11: 68000, 12: 95000 },
                2026: { 1: 185000 }
            },
            countries: {
                2016: { 'Deutschland': 905000, '√ñsterreich': 135000, 'Schweiz': 95000, 'Niederlande': 85000, 'Belgien': 42000, 'Frankreich': 28000, 'Gro√übritannien': 22000, 'Sonstige': 38000 },
                2017: { 'Deutschland': 912000, '√ñsterreich': 138000, 'Schweiz': 98000, 'Niederlande': 82000, 'Belgien': 40000, 'Frankreich': 30000, 'Gro√übritannien': 24000, 'Sonstige': 34000 },
                2018: { 'Deutschland': 945000, '√ñsterreich': 142000, 'Schweiz': 102000, 'Niederlande': 88000, 'Belgien': 42000, 'Frankreich': 32000, 'Gro√übritannien': 25000, 'Sonstige': 28000 },
                2019: { 'Deutschland': 952000, '√ñsterreich': 145000, 'Schweiz': 105000, 'Niederlande': 90000, 'Belgien': 44000, 'Frankreich': 34000, 'Gro√übritannien': 26000, 'Sonstige': 14000 },
                2020: { 'Deutschland': 595000, '√ñsterreich': 102000, 'Schweiz': 58000, 'Niederlande': 42000, 'Belgien': 22000, 'Frankreich': 14000, 'Gro√übritannien': 8000, 'Sonstige': 9000 },
                2021: { 'Deutschland': 644000, '√ñsterreich': 115000, 'Schweiz': 62000, 'Niederlande': 45000, 'Belgien': 24000, 'Frankreich': 15000, 'Gro√übritannien': 6000, 'Sonstige': 9000 },
                2022: { 'Deutschland': 870000, '√ñsterreich': 130000, 'Schweiz': 88000, 'Niederlande': 78000, 'Belgien': 38000, 'Frankreich': 26000, 'Gro√übritannien': 18000, 'Sonstige': 12000 },
                2023: { 'Deutschland': 895000, '√ñsterreich': 135000, 'Schweiz': 92000, 'Niederlande': 82000, 'Belgien': 40000, 'Frankreich': 28000, 'Gro√übritannien': 14000, 'Sonstige': 9000 },
                2024: { 'Deutschland': 925000, '√ñsterreich': 142000, 'Schweiz': 98000, 'Niederlande': 88000, 'Belgien': 42000, 'Frankreich': 30000, 'Gro√übritannien': 8000, 'Sonstige': 7000 },
                2025: { 'Deutschland': 942000, '√ñsterreich': 148000, 'Schweiz': 102000, 'Niederlande': 92000, 'Belgien': 44000, 'Frankreich': 24000, 'Gro√übritannien': 6000, 'Sonstige': 7000 }
            },
            accommodation: {
                2016: { 'Hotels': 590000, 'Ferienwohnungen': 485000, 'Private': 225000, 'Sonstige': 50000 },
                2017: { 'Hotels': 595000, 'Ferienwohnungen': 492000, 'Private': 220000, 'Sonstige': 51000 },
                2018: { 'Hotels': 615000, 'Ferienwohnungen': 512000, 'Private': 225000, 'Sonstige': 52000 },
                2019: { 'Hotels': 620000, 'Ferienwohnungen': 520000, 'Private': 218000, 'Sonstige': 52000 },
                2020: { 'Hotels': 365000, 'Ferienwohnungen': 320000, 'Private': 135000, 'Sonstige': 30000 },
                2021: { 'Hotels': 395000, 'Ferienwohnungen': 345000, 'Private': 148000, 'Sonstige': 32000 },
                2022: { 'Hotels': 545000, 'Ferienwohnungen': 478000, 'Private': 198000, 'Sonstige': 39000 },
                2023: { 'Hotels': 558000, 'Ferienwohnungen': 495000, 'Private': 202000, 'Sonstige': 40000 },
                2024: { 'Hotels': 572000, 'Ferienwohnungen': 518000, 'Private': 208000, 'Sonstige': 42000 },
                2025: { 'Hotels': 582000, 'Ferienwohnungen': 535000, 'Private': 205000, 'Sonstige': 43000 }
            }
        };

        document.addEventListener('DOMContentLoaded', () => { initTheme(); initEvents(); loadData(); });

        function initTheme() {
            const saved = localStorage.getItem('theme');
            if (saved === 'dark' || (!saved && window.matchMedia('(prefers-color-scheme: dark)').matches)) document.documentElement.setAttribute('data-theme', 'dark');
        }
        function toggleTheme() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
        }

        function initEvents() {
            document.querySelectorAll('.tab[data-chart]').forEach(t => t.addEventListener('click', () => { document.querySelectorAll('.tab[data-chart]').forEach(x => x.classList.remove('active')); t.classList.add('active'); updateMainChart(); }));
            ['yearFrom', 'yearTo'].forEach(id => document.getElementById(id)?.addEventListener('change', updateMainChart));
            document.getElementById('monthlyYear')?.addEventListener('change', updateMonthlyChart);
            document.getElementById('countryYear')?.addEventListener('change', () => { updateCountryPie(); updateCountryList(); });
            ['countryTrendFrom', 'countryTrendTo'].forEach(id => document.getElementById(id)?.addEventListener('change', updateCountryTrend));
            document.getElementById('accommodationYear')?.addEventListener('change', () => { updateAccommodationCards(); updateAccommodationChart(); });
        }

        async function loadData() {
            setStatus('loading', 'Lade...');
            let mainOK = false, countryOK = false;
            
            // Lade Hauptdaten
            try { 
                const csv = await fetchCSV(CONFIG.CSV_URL);
                if (csv) { 
                    parseMainCSV(csv); 
                    if (yearlyData.length > 5) {
                        mainOK = true;
                    }
                } 
            } catch (e) { console.log('Hauptdaten Fehler:', e); }
            
            // Lade L√§nderdaten
            try { 
                const csv = await fetchCSV(CONFIG.COUNTRIES_CSV_URL);
                if (csv) { 
                    parseCountriesCSV(csv); 
                    if (Object.keys(countryData).length > 3) {
                        countryOK = true;
                    }
                } 
            } catch (e) { console.log('L√§nderdaten Fehler:', e); }
            
            // Fallback wenn n√∂tig
            if (!mainOK) { 
                yearlyData = [...FALLBACK.yearly]; 
                monthlyData = JSON.parse(JSON.stringify(FALLBACK.monthly)); 
                accommodationData = JSON.parse(JSON.stringify(FALLBACK.accommodation)); 
            }
            if (!countryOK) { 
                countryData = JSON.parse(JSON.stringify(FALLBACK.countries)); 
            }
            
            setStatus(mainOK ? 'live' : 'offline', mainOK ? 'Live-Daten' : 'Offline-Daten');
            populateSelectors();
            updateAll();
        }

        async function fetchCSV(localUrl) {
            try { 
                console.log('Lade:', localUrl);
                const r = await fetch(localUrl); 
                if (r.ok) { 
                    const text = await r.text();
                    if (text && text.length > 500 && !text.includes('<!DOCTYPE')) {
                        console.log('‚úì Geladen:', localUrl);
                        return text;
                    }
                }
            } catch (e) { console.log('Fehler:', e); }
            return null;
        }

        function parseMainCSV(csv) {
            const lines = csv.split('\n').filter(l => l.trim());
            const d = lines[0].includes(';') ? ';' : ',';
            const h = lines[0].toLowerCase().split(d).map(x => x.trim().replace(/"/g, ''));
            
            console.log('CSV Headers:', h);
            
            // Finde Spaltenindizes - exakte Namen aus data.gv.at
            const c = { 
                year: h.findIndex(x => x === 'berichtsjahr' || x === 'tourismusjahr' || /jahr/i.test(x)), 
                month: h.findIndex(x => x === 'monat'), 
                gkz: h.findIndex(x => x === 'gkz'), 
                nights: h.findIndex(x => x === 'naechtigungen' || x === 'n√§chtigungen'), 
                arrivals: h.findIndex(x => x === 'ankuenfte' || x === 'ank√ºnfte'), 
                type: h.findIndex(x => x === 'hauptgliederung'), 
                status: h.findIndex(x => x === 'status'),
                gemeinde: h.findIndex(x => x === 'gemeinde')
            };
            
            console.log('Column indices:', c);
            
            const yA = {}, mA = {}, aA = {};
            let rowCount = 0, matchCount = 0;
            
            for (let i = 1; i < lines.length; i++) {
                const v = lines[i].split(d).map(x => x.trim().replace(/"/g, ''));
                rowCount++;
                
                // GKZ pr√ºfen - Kleinwalsertal = 80228
                const gkz = c.gkz >= 0 ? v[c.gkz] : '';
                if (gkz !== '80228' && gkz !== 80228) continue;
                
                matchCount++;
                
                const year = parseInt(v[c.year]) || 0; 
                if (year < 2015 || year > 2030) continue;
                
                const month = parseMonth(v[c.month]);
                const nights = parseNum(v[c.nights]);
                const arrivals = parseNum(v[c.arrivals]);
                const type = c.type >= 0 ? v[c.type] : '';
                const status = c.status >= 0 ? v[c.status] : '';
                
                if (!yA[year]) yA[year] = { year, nights: 0, arrivals: 0, months: new Set(), status: 'actual' };
                yA[year].nights += nights; 
                yA[year].arrivals += arrivals; 
                yA[year].months.add(month);
                if (/vorl√§ufig/i.test(status)) yA[year].status = 'estimated';
                
                if (!mA[year]) mA[year] = {}; 
                if (!mA[year][month]) mA[year][month] = 0; 
                mA[year][month] += nights;
                
                if (type && !/gesamt|insgesamt/i.test(type)) { 
                    if (!aA[year]) aA[year] = {}; 
                    if (!aA[year][type]) aA[year][type] = 0; 
                    aA[year][type] += nights; 
                }
            }
            
            console.log('Rows:', rowCount, 'Matches (GKZ 80228):', matchCount);
            console.log('Years found:', Object.keys(yA));
            
            yearlyData = Object.values(yA).map(x => ({ ...x, status: x.months.size < 12 ? 'estimated' : x.status })).sort((a, b) => a.year - b.year);
            monthlyData = mA; 
            accommodationData = aA;
        }

        function parseCountriesCSV(csv) {
            const lines = csv.split('\n').filter(l => l.trim());
            const d = lines[0].includes(';') ? ';' : ',';
            const h = lines[0].toLowerCase().split(d).map(x => x.trim().replace(/"/g, ''));
            
            console.log('Countries CSV Headers:', h);
            
            const c = { 
                year: h.findIndex(x => x === 'berichtsjahr' || x === 'tourismusjahr' || /jahr/i.test(x)), 
                gkz: h.findIndex(x => x === 'gkz'), 
                nights: h.findIndex(x => x === 'naechtigungen' || x === 'n√§chtigungen'), 
                country: h.findIndex(x => x === 'staat' || x === 'herkunftsland' || /staat|land|herkunft/i.test(x)) 
            };
            
            console.log('Countries column indices:', c);
            
            const a = {};
            let matchCount = 0;
            
            for (let i = 1; i < lines.length; i++) {
                const v = lines[i].split(d).map(x => x.trim().replace(/"/g, ''));
                const gkz = c.gkz >= 0 ? v[c.gkz] : '';
                if (gkz !== '80228' && gkz !== 80228) continue;
                
                matchCount++;
                
                const year = parseInt(v[c.year]) || 0; 
                if (year < 2015 || year > 2030) continue;
                
                const nights = parseNum(v[c.nights]);
                let country = c.country >= 0 ? v[c.country] : 'Sonstige';
                
                // Normalize country names
                if (/deutsch/i.test(country)) country = 'Deutschland';
                else if (/√∂ster|austria/i.test(country)) country = '√ñsterreich';
                else if (/schweiz|swiss/i.test(country)) country = 'Schweiz';
                else if (/niederl|holland/i.test(country)) country = 'Niederlande';
                else if (/belg/i.test(country)) country = 'Belgien';
                else if (/frank/i.test(country)) country = 'Frankreich';
                else if (/brit|uk|england|vereinigtes/i.test(country)) country = 'Gro√übritannien';
                else if (/italien/i.test(country)) country = 'Italien';
                
                if (!a[year]) a[year] = {}; 
                if (!a[year][country]) a[year][country] = 0; 
                a[year][country] += nights;
            }
            
            console.log('Countries matches:', matchCount, 'Years:', Object.keys(a));
            countryData = a;
        }

        function parseMonth(s) { if (!s) return 1; const n = parseInt(s); if (!isNaN(n) && n >= 1 && n <= 12) return n; const m = { 'j√§n': 1, 'jan': 1, 'feb': 2, 'm√§r': 3, 'mar': 3, 'apr': 4, 'mai': 5, 'jun': 6, 'jul': 7, 'aug': 8, 'sep': 9, 'okt': 10, 'nov': 11, 'dez': 12 }; return m[s.toLowerCase().substring(0, 3)] || 1; }
        function parseNum(s) { if (!s) return 0; return parseInt(s.replace(/[.\s]/g, '').replace(',', '.')) || 0; }
        function setStatus(t, txt) { document.getElementById('statusDot').className = 'status-dot ' + (t === 'live' ? '' : t); document.getElementById('statusText').textContent = txt; }
        function formatNum(n) { return n == null ? '‚Äî' : new Intl.NumberFormat('de-AT').format(Math.round(n)); }

        function populateSelectors() {
            const years = yearlyData.map(d => d.year);
            const min = Math.min(...years), max = Math.max(...years);
            ['yearFrom', 'yearTo', 'monthlyYear', 'countryYear', 'countryTrendFrom', 'countryTrendTo', 'accommodationYear'].forEach(id => {
                const el = document.getElementById(id); if (!el) return;
                el.innerHTML = ''; for (let y = max; y >= min; y--) el.innerHTML += `<option value="${y}">${y}</option>`;
            });
            // Defaults: 10 Jahre
            document.getElementById('yearFrom').value = Math.max(min, max - 10);
            document.getElementById('yearTo').value = max;
            document.getElementById('countryTrendFrom').value = Math.max(min, 2016);
            document.getElementById('countryTrendTo').value = 2025;
            document.getElementById('monthlyYear').value = 2025;
            document.getElementById('countryYear').value = 2025;
            document.getElementById('accommodationYear').value = 2025;
        }

        function updateAll() { updateKPIs(); updateMainChart(); updateMonthlyChart(); updateTable(); updateHeatmap(); updateCountryPie(); updateCountryList(); updateCountryTrend(); updateAccommodationCards(); updateAccommodationChart(); }

        function updateKPIs() {
            const y2025 = yearlyData.find(d => d.year === 2025);
            const y2024 = yearlyData.find(d => d.year === 2024);
            const y2026 = yearlyData.find(d => d.year === 2026);
            if (y2025) {
                document.getElementById('kpiNights').textContent = formatNum(y2025.nights);
                document.getElementById('kpiArrivals').textContent = formatNum(y2025.arrivals);
                document.getElementById('kpiStay').textContent = y2025.arrivals > 0 ? (y2025.nights / y2025.arrivals).toFixed(1) : '‚Äî';
                if (y2024) {
                    setTrend('kpiNightsTrend', ((y2025.nights - y2024.nights) / y2024.nights * 100).toFixed(1));
                    setTrend('kpiArrivalsTrend', ((y2025.arrivals - y2024.arrivals) / y2024.arrivals * 100).toFixed(1));
                }
            }
            const cD = countryData[2025] || FALLBACK.countries[2025];
            if (cD) { const sorted = Object.entries(cD).sort((a, b) => b[1] - a[1]); const top = sorted[0]; if (top) { document.getElementById('kpiTopCountry').textContent = CONFIG.COUNTRY_FLAGS[top[0]] || 'üåç'; const total = sorted.reduce((s, [, v]) => s + v, 0); document.getElementById('kpiTopCountryPct').textContent = `${top[0]} ${(top[1] / total * 100).toFixed(0)}%`; } }
            if (y2026) document.getElementById('kpi2026').textContent = formatNum(y2026.nights);
        }

        function setTrend(id, change) { const el = document.getElementById(id); if (!el) return; const pos = parseFloat(change) >= 0; el.className = 'kpi-trend ' + (pos ? 'up' : 'down'); el.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="${pos ? 'M18 15l-6-6-6 6' : 'M6 9l6 6 6-6'}"/></svg>${pos ? '+' : ''}${change}%`; }

        function updateMainChart() {
            const from = parseInt(document.getElementById('yearFrom').value), to = parseInt(document.getElementById('yearTo').value);
            const type = document.querySelector('.tab[data-chart].active')?.dataset.chart || 'line';
            const filtered = yearlyData.filter(d => d.year >= from && d.year <= to);
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const ctx = document.getElementById('mainChart').getContext('2d');
            if (mainChart) mainChart.destroy();
            mainChart = new Chart(ctx, {
                type,
                data: { labels: filtered.map(d => d.year), datasets: [
                    { label: '√úbernachtungen', data: filtered.map(d => d.nights), borderColor: '#1e3a5f', backgroundColor: type === 'bar' ? filtered.map(d => d.status === 'estimated' ? 'rgba(201,162,39,0.7)' : 'rgba(30,58,95,0.7)') : 'rgba(30,58,95,0.1)', tension: 0.3, fill: type === 'line', pointBackgroundColor: filtered.map(d => d.status === 'estimated' ? '#c9a227' : '#1e3a5f'), pointRadius: 5 },
                    { label: 'Ank√ºnfte', data: filtered.map(d => d.arrivals), borderColor: '#4a9b7f', backgroundColor: type === 'bar' ? 'rgba(74,155,127,0.5)' : 'rgba(74,155,127,0.1)', tension: 0.3, fill: type === 'line', yAxisID: 'y1', pointRadius: 5 }
                ] },
                options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false }, plugins: { legend: { labels: { color: isDark ? '#e6edf3' : '#1a2a3a' } }, tooltip: { callbacks: { label: c => `${c.dataset.label}: ${formatNum(c.raw)}` } } }, scales: { x: { ticks: { color: isDark ? '#e6edf3' : '#1a2a3a' }, grid: { color: isDark ? '#30363d' : '#e5eaef' } }, y: { position: 'left', ticks: { color: isDark ? '#e6edf3' : '#1a2a3a', callback: v => formatNum(v) }, grid: { color: isDark ? '#30363d' : '#e5eaef' }, title: { display: true, text: '√úbernachtungen', color: isDark ? '#e6edf3' : '#1a2a3a' } }, y1: { position: 'right', ticks: { color: isDark ? '#e6edf3' : '#1a2a3a', callback: v => formatNum(v) }, grid: { drawOnChartArea: false }, title: { display: true, text: 'Ank√ºnfte', color: isDark ? '#e6edf3' : '#1a2a3a' } } } }
            });
        }

        function updateMonthlyChart() {
            const year = parseInt(document.getElementById('monthlyYear').value);
            const data = monthlyData[year] || FALLBACK.monthly[year] || {};
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const values = CONFIG.MONTHS_DE.map((_, i) => data[i + 1] || 0);
            const ctx = document.getElementById('monthlyChart').getContext('2d');
            if (monthlyChart) monthlyChart.destroy();
            monthlyChart = new Chart(ctx, {
                type: 'bar',
                data: { labels: CONFIG.MONTHS_FULL, datasets: [{ label: '√úbernachtungen', data: values, backgroundColor: values.map((v, i) => v === 0 ? 'rgba(200,200,200,0.3)' : (i >= 10 || i <= 2 ? 'rgba(30,58,95,0.8)' : 'rgba(74,155,127,0.7)')), borderRadius: 4 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { callbacks: { label: c => c.raw > 0 ? formatNum(c.raw) + ' √úN' : 'Keine Daten' } } }, scales: { x: { ticks: { color: isDark ? '#e6edf3' : '#1a2a3a' }, grid: { display: false } }, y: { ticks: { color: isDark ? '#e6edf3' : '#1a2a3a', callback: v => formatNum(v) }, grid: { color: isDark ? '#30363d' : '#e5eaef' } } } }
            });
        }

        function updateTable() {
            document.getElementById('tableBody').innerHTML = [...yearlyData].reverse().map(d => {
                const prev = yearlyData.find(x => x.year === d.year - 1);
                const change = prev ? ((d.nights - prev.nights) / prev.nights * 100) : null;
                const stay = d.arrivals > 0 ? (d.nights / d.arrivals).toFixed(1) : '‚Äî';
                const statusText = d.status === 'estimated' ? (d.year === 2026 ? 'J√§nner' : 'Vorl√§ufig') : 'Endg√ºltig';
                return `<tr><td class="table-year">${d.year}</td><td class="table-number">${formatNum(d.nights)}</td><td class="table-number">${formatNum(d.arrivals)}</td><td>${stay}</td><td>${change !== null ? `<span class="table-change ${change >= 0 ? 'positive' : 'negative'}">${change >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(change).toFixed(1)}%</span>` : '‚Äî'}</td><td><span class="badge ${d.status === 'estimated' ? 'badge-estimated' : 'badge-actual'}">${statusText}</span></td></tr>`;
            }).join('');
        }

        function updateHeatmap() {
            const container = document.getElementById('heatmapContainer');
            const years = [2022, 2023, 2024, 2025, 2026];
            let allVals = [];
            years.forEach(y => { const d = monthlyData[y] || FALLBACK.monthly[y] || {}; Object.values(d).forEach(v => { if (v > 0) allVals.push(v); }); });
            const minV = Math.min(...allVals), maxV = Math.max(...allVals);
            const colors = ['#dbeafe', '#93c5fd', '#3b82f6', '#1d4ed8', '#1e3a5f'];
            const getColor = v => { if (!v) return '#f1f5f9'; const p = (v - minV) / (maxV - minV); return colors[Math.min(Math.floor(p * colors.length), colors.length - 1)]; };
            let html = '<div class="heatmap-grid"><div></div>';
            CONFIG.MONTHS_DE.forEach(m => html += `<div class="heatmap-header">${m}</div>`);
            years.forEach(year => {
                html += `<div class="heatmap-row-label">${year}</div>`;
                const d = monthlyData[year] || FALLBACK.monthly[year] || {};
                for (let m = 1; m <= 12; m++) {
                    const v = d[m] || 0;
                    const col = getColor(v);
                    const textCol = v > 0 && (v - minV) / (maxV - minV) > 0.5 ? 'white' : '#1a2a3a';
                    html += `<div class="heatmap-cell" style="background:${col};color:${textCol}"><span class="tooltip">${CONFIG.MONTHS_FULL[m - 1]} ${year}: ${v ? formatNum(v) + ' √úN' : 'Keine Daten'}</span></div>`;
                }
            });
            html += '</div>';
            container.innerHTML = html;
        }

        function updateCountryPie() {
            const year = parseInt(document.getElementById('countryYear').value);
            const data = countryData[year] || FALLBACK.countries[year] || FALLBACK.countries[2025];
            const sorted = Object.entries(data).sort((a, b) => b[1] - a[1]).slice(0, 8);
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const ctx = document.getElementById('countryPieChart').getContext('2d');
            if (countryPieChart) countryPieChart.destroy();
            countryPieChart = new Chart(ctx, {
                type: 'doughnut',
                data: { labels: sorted.map(([c]) => c), datasets: [{ data: sorted.map(([, v]) => v), backgroundColor: CONFIG.COUNTRY_COLORS, borderWidth: 2, borderColor: isDark ? '#161b22' : '#fff' }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { color: isDark ? '#e6edf3' : '#1a2a3a', padding: 12 } }, tooltip: { callbacks: { label: c => { const t = c.dataset.data.reduce((a, b) => a + b, 0); return `${c.label}: ${formatNum(c.raw)} (${(c.raw / t * 100).toFixed(1)}%)`; } } } } }
            });
        }

        function updateCountryList() {
            const year = parseInt(document.getElementById('countryYear').value);
            const data = countryData[year] || FALLBACK.countries[year] || FALLBACK.countries[2025];
            const sorted = Object.entries(data).sort((a, b) => b[1] - a[1]).slice(0, 8);
            const total = sorted.reduce((s, [, v]) => s + v, 0), max = sorted[0]?.[1] || 1;
            document.getElementById('countryList').innerHTML = sorted.map(([c, n]) => `<div class="country-item"><span class="country-flag">${CONFIG.COUNTRY_FLAGS[c] || 'üåê'}</span><div style="flex:1"><div class="country-name">${c}<span class="country-pct">${(n / total * 100).toFixed(1)}%</span></div><div class="country-bar"><div class="country-bar-fill" style="width:${(n / max * 100).toFixed(0)}%"></div></div></div><span class="country-value">${formatNum(n)}</span></div>`).join('');
        }

        function updateCountryTrend() {
            const from = parseInt(document.getElementById('countryTrendFrom').value), to = parseInt(document.getElementById('countryTrendTo').value);
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const latest = countryData[to] || FALLBACK.countries[to] || FALLBACK.countries[2025];
            const topC = Object.entries(latest).sort((a, b) => b[1] - a[1]).slice(0, 5).map(([c]) => c);
            const years = []; for (let y = from; y <= to; y++) years.push(y);
            const datasets = topC.map((c, i) => ({ label: c, data: years.map(y => (countryData[y] || FALLBACK.countries[y] || {})[c] || null), borderColor: CONFIG.COUNTRY_COLORS[i], backgroundColor: CONFIG.COUNTRY_COLORS[i] + '20', tension: 0.3, pointRadius: 4 }));
            const ctx = document.getElementById('countryTrendChart').getContext('2d');
            if (countryTrendChart) countryTrendChart.destroy();
            countryTrendChart = new Chart(ctx, {
                type: 'line',
                data: { labels: years, datasets },
                options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false }, plugins: { legend: { labels: { color: isDark ? '#e6edf3' : '#1a2a3a' } }, tooltip: { callbacks: { label: c => c.raw ? `${c.dataset.label}: ${formatNum(c.raw)}` : null } } }, scales: { x: { ticks: { color: isDark ? '#e6edf3' : '#1a2a3a' }, grid: { color: isDark ? '#30363d' : '#e5eaef' } }, y: { ticks: { color: isDark ? '#e6edf3' : '#1a2a3a', callback: v => formatNum(v) }, grid: { color: isDark ? '#30363d' : '#e5eaef' } } } }
            });
        }

        function updateAccommodationCards() {
            const year = parseInt(document.getElementById('accommodationYear').value);
            const data = accommodationData[year] || FALLBACK.accommodation[year] || FALLBACK.accommodation[2025];
            const prev = accommodationData[year - 1] || FALLBACK.accommodation[year - 1] || {};
            const total = Object.values(data).reduce((s, v) => s + v, 0);
            document.getElementById('accommodationCards').innerHTML = Object.entries(data).map(([t, n]) => {
                const info = CONFIG.ACCOMMODATION_TYPES[t] || { icon: 'üè†', color: '#8b9eb3' };
                const pct = total > 0 ? (n / total * 100).toFixed(1) : 0;
                const prevN = prev[t] || 0;
                const change = prevN > 0 ? ((n - prevN) / prevN * 100).toFixed(1) : null;
                return `<div class="accommodation-card"><div class="accommodation-icon">${info.icon}</div><div class="accommodation-name">${t}</div><div class="accommodation-value">${formatNum(n)}</div><div class="accommodation-pct">${pct}% Anteil</div>${change !== null ? `<div class="accommodation-trend ${parseFloat(change) >= 0 ? 'up' : 'down'}">${parseFloat(change) >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(change)}% vs. Vorjahr</div>` : ''}</div>`;
            }).join('');
        }

        function updateAccommodationChart() {
            const years = yearlyData.filter(d => d.status === 'actual').map(d => d.year).slice(-6);
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const types = Object.keys(accommodationData[years[years.length - 1]] || FALLBACK.accommodation[2025]);
            const datasets = types.map((t, i) => ({ label: t, data: years.map(y => (accommodationData[y] || FALLBACK.accommodation[y] || {})[t] || 0), backgroundColor: (CONFIG.ACCOMMODATION_TYPES[t]?.color || CONFIG.COUNTRY_COLORS[i]) + 'cc', borderRadius: 4 }));
            const ctx = document.getElementById('accommodationChart').getContext('2d');
            if (accommodationChart) accommodationChart.destroy();
            accommodationChart = new Chart(ctx, {
                type: 'bar',
                data: { labels: years, datasets },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: isDark ? '#e6edf3' : '#1a2a3a' } }, tooltip: { callbacks: { label: c => `${c.dataset.label}: ${formatNum(c.raw)}` } } }, scales: { x: { stacked: true, ticks: { color: isDark ? '#e6edf3' : '#1a2a3a' }, grid: { display: false } }, y: { stacked: true, ticks: { color: isDark ? '#e6edf3' : '#1a2a3a', callback: v => formatNum(v) }, grid: { color: isDark ? '#30363d' : '#e5eaef' } } } }
            });
        }

        function exportCSV() {
            const rows = [['Jahr', '√úbernachtungen', 'Ank√ºnfte', 'Aufenthalt', 'Status'], ...yearlyData.map(d => [d.year, d.nights, d.arrivals, d.arrivals > 0 ? (d.nights / d.arrivals).toFixed(2) : '', d.status])];
            const csv = rows.map(r => r.join(';')).join('\n');
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `kleinwalsertal-tourismus-2026-02-04.csv`; a.click();
        }
    </script>
</body>
</html>
